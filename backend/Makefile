.PHONY: local prod clean

# Local development
local: clean
	@echo "ðŸš€ Starting local server..."
	PYTHONPATH=. uvicorn app.main:app --reload --host 0.0.0.0 --port 8080

# Production with Docker and ngrok
prod: clean
	@echo "ðŸ—ï¸  Building Docker container..."
	docker build -t hackireland-app .
	@echo "ðŸš€ Starting application..."
	docker run -d -p 8080:8080 hackireland-app
	@echo "ðŸŒ Starting ngrok tunnel..."
	@(pkill ngrok || true) && ngrok http 8080

# Cleanup
clean:
	@echo "ðŸ§¹ Cleaning up..."
	@docker stop $$(docker ps -q --filter ancestor=hackireland-app) 2>/dev/null || true
	@docker rm $$(docker ps -a -q --filter ancestor=hackireland-app) 2>/dev/null || true
	@pkill ngrok || true
	@echo "Freeing port 8080..."
	@lsof -ti:8080 | xargs kill -9 2>/dev/null || true
